# tmux configuration
# ~/.dotfiles/config/tmux/tmux.conf
# Wezterm互換キーバインド

# ===== General =====
set -g default-terminal "tmux-256color"
set -g allow-passthrough on
set -ag terminal-overrides ",xterm-256color:RGB"
set -g mouse on
set -g history-limit 50000
set -sg escape-time 10
set -g focus-events on
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on

# ===== Prefix Key =====
# Ctrl+a をプリフィックスに
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# ===== Key Bindings (Wezterm互換) =====

# 設定リロード（CMD+Shift+R → Ctrl+a r）
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# --- ペイン分割 ---
# CMD+D → | で水平分割（右に分割）
bind | split-window -h -c "#{pane_current_path}"
# CMD+Shift+D → - で垂直分割（下に分割）
bind - split-window -v -c "#{pane_current_path}"

# tmuxデフォルトも残す
bind % split-window -h -c "#{pane_current_path}"
bind '"' split-window -v -c "#{pane_current_path}"

# --- ウインドウ操作 ---
# CMD+T → c で新規ウインドウ
bind c new-window -c "#{pane_current_path}"

# CMD+W → & でウインドウを閉じる（確認あり）
bind & kill-window

# Ctrl+Tab → n/p でウインドウ移動
bind -r n next-window
bind -r p previous-window

# CMD+1-9 → 数字でウインドウ移動（デフォルトで動作）

# --- ペイン移動（Vimスタイル）---
# CMD+Alt+h/j/k/l → h/j/k/l
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# --- ペインリサイズ ---
# CMD+Alt+Shift+H/J/K/L → H/J/K/L
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# --- ペイン閉じる ---
# CMD+Shift+W → x
bind x kill-pane

# --- ペイン最大化 ---
# CMD+Shift+Z → z（デフォルト）

# --- マウストグル ---
# Ctrl+a m でマウス操作ON/OFF切り替え
bind m if-shell "tmux show -g mouse | grep -q on" \
    "set -g mouse off; display 'Mouse: OFF'" \
    "set -g mouse on; display 'Mouse: ON'"

# ===== コピーモード（Vimスタイル）=====
setw -g mode-keys vi
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
bind -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "pbcopy"

# ===== Appearance (Tokyo Night) =====
set -g status-position bottom
set -g status-style bg=default,fg=#c0caf5

# 背景を透明にしてGhosttyの背景画像を表示
set -g window-style bg=default
set -g window-active-style bg=default

# 左側：セッション名
set -g status-left-length 30
set -g status-left "#[fg=#1a1b26,bg=#7aa2f7,bold] #S #[fg=#7aa2f7,bg=#1a1b26]"

# 右側：マウス状態 + 日時
set -g status-right-length 60
set -g status-right "#[fg=#3b4261]#[fg=#c0caf5,bg=#3b4261] Mouse:#{?mouse,ON,OFF} | %m/%d #[fg=#7aa2f7]#[fg=#1a1b26,bg=#7aa2f7,bold] %H:%M "

# ウインドウリスト
set -g status-justify left
setw -g window-status-format "#[fg=#565f89] #I:#W "
setw -g window-status-current-format "#[fg=#1a1b26,bg=#7aa2f7,bold] #I:#W #[fg=#7aa2f7,bg=#1a1b26]"

# ペインボーダー
set -g pane-border-style fg=#3b4261
set -g pane-active-border-style fg=#7aa2f7

# メッセージ
set -g message-style bg=#7aa2f7,fg=#1a1b26

