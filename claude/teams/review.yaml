name: review-team
description: "3モデル戦略レビュー: Claude (設計・アーキ) + Gemini (最新ベストプラクティス) + Codex (バグ・セキュリティ) の3社並列レビュー"
category: review

# === 3-Model Review Strategy ===
#
# 各 AI プロバイダの強みに特化した役割分担:
#
# | Provider  | Agent              | Focus                        | Why                              |
# |-----------|--------------------|------------------------------|----------------------------------|
# | Claude    | review             | Architecture, Design, Logic  | Deep reasoning, long context     |
# | Gemini    | code-reviewer-gemini | Best Practices, Deprecation | Google Search grounding          |
# | OpenAI    | codex-reviewer     | Bug Patterns, Security       | Pattern matching, OWASP          |
#
# 補助レビュワー (Claude-based, 観点特化):
# - clean-code-fp-reviewer: 凝集度・結合度・関数型パターン
# - security: セキュリティ深掘り (Codex と相互補完)
# - 言語別レビュワー: go-reviewer / typescript-reviewer

lead:
  name: aggregator
  subagent_type: general-purpose
  role: "レビュー結果の集約・レポート作成・3モデル結果の統合"
  responsibilities:
    - "3プロバイダ (Claude/Gemini/Codex) の結果を統合"
    - "重複指摘の排除とユニーク指摘の抽出"
    - "Critical/Major/Minor への分類"
    - "修正サイクルの管理（--auto モード時）"

members:
  # === Core 3-Model Reviewers (常に並列実行) ===

  - name: claude-reviewer
    subagent_type: review
    role: "Claude: 設計・アーキテクチャ・ロジック深掘りレビュー"
    responsibilities:
      - "アーキテクチャ影響度の分析"
      - "設計パターンの正誤判定"
      - "複雑なビジネスロジックの検証"
      - "API 契約と後方互換性の確認"
      - "型設計の妥当性評価"
    condition: "always"

  - name: gemini-reviewer
    subagent_type: code-reviewer-gemini
    role: "Gemini: Web 検索付き最新ベストプラクティスレビュー"
    responsibilities:
      - "最新ベストプラクティスとの照合 (Google Search grounding)"
      - "非推奨 API・パターンの検出"
      - "ライブラリの既知問題・脆弱性の確認"
      - "マイグレーション推奨の提示"
    condition: "always"

  - name: codex-reviewer
    subagent_type: codex-reviewer
    role: "Codex: バグパターン検出・セキュリティ脆弱性分析"
    responsibilities:
      - "バグパターンの検出 (null ref, off-by-one, etc.)"
      - "OWASP Top 10 セキュリティ脆弱性の検出"
      - "エラーハンドリングのギャップ検出"
      - "並行処理の問題検出"
    condition: "always"

  # === Supplementary Reviewers (Claude-based, 観点特化) ===

  - name: clean-code-reviewer
    subagent_type: clean-code-fp-reviewer
    role: "クリーンコード＆関数型プログラミング観点"
    responsibilities:
      - "凝集度・結合度の評価"
      - "命名規則の確認"
      - "純粋関数・イミュータビリティの推奨"
    condition: "always"

  - name: security-reviewer
    subagent_type: security
    role: "セキュリティ深掘り分析 (Codex レビューを補完)"
    responsibilities:
      - "Codex が検出した脆弱性の詳細分析"
      - "認証・認可フローの検証"
      - "データ保護・暗号化の確認"
    condition: "always"

  # === Language-Specific Reviewers (該当言語がある場合のみ) ===

  - name: go-reviewer
    subagent_type: go-reviewer
    role: "Go コード専門レビュー"
    responsibilities:
      - "Idiomatic Go パターンの確認"
      - "エラーハンドリングの検証"
      - "テストカバレッジの評価"
      - "レイヤー責任の確認"
    condition: "language:go"

  - name: typescript-reviewer
    subagent_type: typescript-reviewer
    role: "TypeScript/React 専門レビュー"
    responsibilities:
      - "型安全性の確認"
      - "パフォーマンス問題の検出"
      - "React パターンの評価"
      - "レイヤー責任の確認"
    condition: "language:typescript"

language_variants: {}

workflow:
  steps:
    - name: detection
      description: "変更ファイルの検出と言語分類"
      execution: sequential
      tasks:
        - name: detect-changes
          assigned_to: aggregator
          description: "git diff で変更ファイルを検出し、言語ごとに分類する"
          inputs:
            - "git diff --name-only HEAD"
            - "git diff --staged --name-only"
          outputs:
            - "changed_files_by_language"
            - "detected_languages"

    - name: core-3model-review
      description: "3プロバイダ (Claude/Gemini/Codex) による並列コアレビュー"
      execution: parallel
      tasks:
        - name: claude-architecture-review
          assigned_to: claude-reviewer
          description: "Claude: アーキテクチャ・設計・ロジックの深掘りレビュー"
          inputs:
            - "changed_files_by_language"
            - "git diff"
            - "surrounding context files"
          outputs:
            - "claude_issues"

        - name: gemini-bestpractice-review
          assigned_to: gemini-reviewer
          description: "Gemini: 最新ベストプラクティスとの照合 (Web 検索付き)"
          inputs:
            - "changed_files_by_language"
            - "git diff"
          outputs:
            - "gemini_issues"

        - name: codex-bugsec-review
          assigned_to: codex-reviewer
          description: "Codex: バグパターン・セキュリティ脆弱性の検出"
          inputs:
            - "changed_files_by_language"
            - "git diff"
          outputs:
            - "codex_issues"

    - name: supplementary-review
      description: "補助レビュワーによる並列レビュー (コア3モデルを補完)"
      execution: parallel
      tasks:
        - name: clean-code-analysis
          assigned_to: clean-code-reviewer
          description: "クリーンコード・関数型プログラミング観点のレビュー"
          inputs:
            - "changed_files_by_language"
            - "git diff"
          outputs:
            - "clean_code_issues"

        - name: security-deep-analysis
          assigned_to: security-reviewer
          description: "セキュリティ深掘り分析 (Codex 結果を参照して補完)"
          inputs:
            - "changed_files_by_language"
            - "git diff"
            - "codex_issues (security-related)"
          outputs:
            - "security_issues"

        - name: go-analysis
          assigned_to: go-reviewer
          description: "Go 専門レビュー（Go ファイルがある場合のみ）"
          inputs:
            - "changed_files_by_language"
            - "git diff (Go files)"
          outputs:
            - "go_issues"

        - name: typescript-analysis
          assigned_to: typescript-reviewer
          description: "TypeScript 専門レビュー（TS/JS ファイルがある場合のみ）"
          inputs:
            - "changed_files_by_language"
            - "git diff (TS/JS files)"
          outputs:
            - "typescript_issues"

    - name: aggregation
      description: "3モデル + 補助レビュー結果の統合とレポート生成"
      execution: sequential
      tasks:
        - name: aggregate-results
          assigned_to: aggregator
          description: >
            全レビュー結果を統合:
            1. 3モデル間の重複指摘を排除
            2. 各モデルのユニークな発見を強調
            3. Critical/Major/Minor に分類
            4. モデル別サマリーを含む統合レポートを生成
          inputs:
            - "claude_issues"
            - "gemini_issues"
            - "codex_issues"
            - "clean_code_issues"
            - "security_issues"
            - "go_issues"
            - "typescript_issues"
          outputs:
            - "review_report"
            - "issues_by_severity"

    - name: fix-cycle
      description: "修正サイクル（--auto モード時のみ、最大5回繰り返し）"
      execution: sequential
      tasks:
        - name: apply-fixes
          assigned_to: aggregator
          description: "Critical + Major 問題を修正し、再レビューを実行"
          inputs:
            - "issues_by_severity"
          outputs:
            - "applied_fixes"
            - "remaining_issues"

completion:
  required_outputs:
    - "review_report"
    - "issues_by_severity"
  quality_gates:
    - "3モデル (Claude/Gemini/Codex) すべてのレビューが完了"
    - "全 Critical 問題が解決済みまたは報告済み"
    - "レビュー結果が統合レポートに含まれている"
    - "モデル別サマリーが含まれている"
